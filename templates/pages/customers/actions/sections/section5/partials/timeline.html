{% load custom_filters %}

{% if tag_message %}
    <script>                
        Swal.fire({
            position: "top-center",
            icon: '{% if "error" in tags %}error{% elif "success" in tags %}success{% elif "info" in tags %}info{% elif "warning" in tags %}warning{% else %}question{% endif %}',
            title: "{{tag_message}}",
            showConfirmButton: false,
            timer: 3000
        });
    </script>
{% endif %}

<!--begin::Timeline-->

{% if fars %}

    {% for far in fars %}

        <div class="timeline timeline-border-dashed">
            <!--begin::Timeline item-->
            <div class="timeline-item">
                <!--begin::Timeline line-->
                <div class="timeline-line"></div>
                <!--end::Timeline line-->
                <!--begin::Timeline icon-->
                <div class="timeline-icon border border-primary">
                    <i class="ki-duotone ki-pencil fs-2 text-primary">
                        <span class="path1"></span>
                        <span class="path2"></span>
                    </i>
                </div>
                <!--end::Timeline icon-->
                <!--begin::Timeline content-->
                <div class="timeline-content mb-10 mt-n1">
                    <!--begin::Timeline heading-->
                    <div class="pe-3 mb-5">
                        <!--begin::Title-->
                        <div class="fs-5 fw-semibold mb-2">Generated at {{ far.encrypted_file.created_at }}</div>
                        <!--end::Title-->
                        <!--begin::Description-->
                        <div class="row">
                            <div class="col-md-12 mb-1">
                                <div class="fs-8 fw-semibold">Uploaded By: {{ far.encrypted_file.uploaded_by.first_name }} {{ far.encrypted_file.uploaded_by.last_name }}</div>
                                <div class="fs-6"></div>
                            </div>
                            <div class="col-md-12 mb-1">
                                <div class="fs-8 fw-semibold">File Name: {{ far.encrypted_file.file.file.name|basename|default:"Unnamed File" }}</div>
                                <div class="fs-6"></div>
                            </div>
                            <div class="col-md-12 mb-1">
                                <div class="fs-8 fw-semibold">File Type: {{ far.encrypted_file.file_type|cut:"." }}</div>
                                <div class="fs-6"></div>
                            </div>
                            <div class="col-md-12 mb-1">
                                <div class="fs-8 fw-semibold">File Size: {{ far.encrypted_file.file.size|filesizeformat }}</div>
                                <div class="fs-6"></div>
                            </div>
                            <div class="col-md-12 mb-1">
                                <div class="fs-8 fw-semibold">Status: {{ far.status }}</div>
                                <div class="fs-6"></div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-start mt-3">
                            <!-- Download Button -->
                            {% if far.encrypted_file %}
                                <a href="{% url 'download_file' far.encrypted_file.id %}" class="btn btn-sm btn-primary me-2">
                                    <i class="bi bi-download"></i> Download
                                </a> 
                            {% endif %}
                            <!-- Delete Button -->
                            {% if far.encrypted_file %}
                                <a href="#" 
                                class="btn btn-sm btn-danger delete-btn" 
                                hx-post="{% url 'delete_far_file_view' far.encrypted_file.id %}" 
                                hx-trigger="click" 
                                hx-target="#kt_activity_today2">
                                    <i class="bi bi-trash"></i> Delete
                                </a>
                            {% endif %}
                        </div>
                        <!--end::Description-->
                    </div>
                    <!--end::Timeline heading-->
                    
                </div>
                <!--end::Timeline content-->
            </div>
            <!--end::Timeline item-->
            
        </div>
    {% endfor %}
{% endif %}
<!--end::Timeline-->